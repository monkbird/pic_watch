## 目标与范围

* 图片浏览：批量/单张查看 `JPG/JPEG`、`PNG`、`TIFF`，支持缩略图与大图预览

* 元数据采集：扫描选定文件夹，提取 EXIF、IPTC、尺寸、文件信息，生成统一 `metadata.json`

* 分类归档：基于 `metadata.json` 按最早时间、父子文件夹（包含了工程类别、项目名称工程开始时间、拍摄时间等）、备注（备注方式和父子文件夹类似）分组；支持筛选与导出分组结果；支持工程类别、项目名称工程开始时间、拍摄时间等的搜索

## UI 布局（对齐示例图片）

* 顶部工具栏：文件夹选择、开始扫描、筛选（下拉/复选）、搜索框、导出 JSON

* 左侧面板：

  * 分类/文件夹树（拍摄时间/文件夹/备注三种视图切换）

  * 复选过滤（格式、尺寸范围、关键字）

* 中间主区域：

  * 缩略图网格（瀑布流/规则网格，支持多选、快速滚动）

  * 支持分页/虚拟化渲染以提升大数据量性能

* 右侧面板：

  * 大图预览（缩放/拖拽/适配窗口）

  * 元数据详情（折叠分组：基本、EXIF、IPTC、文件）

* 底部状态栏：扫描进度、统计、当前筛选条件

## 技术选型

* 桌面框架：`PySide6`

* 图像与元数据：`Pillow`（基本与尺寸）、`exifread`/`piexif`（EXIF）、`iptcinfo3`（IPTC），必要时 `tifffile`（更好 TIFF 支持）

* 并发与缓存：`concurrent.futures`（并发扫描）、缩略图磁盘缓存（避免重复解码）

* 打包：`PyInstaller`

## 目录结构

* `app.py`：应用入口

* `ui/`

  * `main_window.py`：主窗体与布局（顶部、左、中、右、底部）

  * `thumb_list.py`：缩略图网格组件（虚拟化）

  * `preview_panel.py`：大图预览组件

  * `metadata_panel.py`：元数据详情面板

  * `classification_panel.py`：分类/文件夹树与筛选

* `services/metadata.py`：元数据提取与标准化

* `services/scanner.py`：目录扫描、任务队列、缩略图生成

* `services/classifier.py`：JSON 分类分组与导出

* `models/`：数据模型（图片项/元数据结构）

* `utils/`：路径、时间解析、缓存、日志

* `assets/`：图标与样式（可选）

## 核心实现

* 扫描与白名单：扩展名 `jpg/jpeg/png/tif/tiff`；支持跳过隐藏/系统目录

* 元数据采集：

  * 基本：`Pillow` → `format/width/height/mode`

  * EXIF：`Image.getexif()`；必要时 `exifread/piexif` 兜底；解析 `DateTimeOriginal/Make/Model/GPS`

  * IPTC：`iptcinfo3` → `ObjectName/Keywords/Caption`

  * PNG：`Image.info` 与文本块

  * TIFF：`Pillow` +（可选）`tifffile`

  * 统一键：`id/path/rel_path/parent/format/width/height/exif/iptc/file_size/mtime/ctime`

* `metadata.json`：一次性导出与增量更新（合并已有 JSON）

* 分类归档：

  * 时间分组：`DateTimeOriginal` → 年/月/日；无则回退 `mtime`

  * 文件夹层级：基于 `rel_path` 切分树结构

  * 备注分组：`IPTC Caption/Keywords`；支持关键词检索

  * 导出：`groups.json`，或按分组生成索引

* UI 交互：

  * 左侧切换分组视图；选中分组 → 中间网格显示对应图片

  * 中间选择图片 → 右侧预览与元数据详情同步

  * 搜索与筛选实时刷新；状态栏显示统计与进度

## 性能与健壮性

* 并发扫描与渐进加载；对超大图进行受限解码尺寸

* 缩略图磁盘缓存 + 内存 LRU；异常文件不阻塞总流程

* 中文路径兼容，错误日志记录并统计

## 验证与测试

* 单元测试：`metadata`、`classifier` 核心函数

* 实地测试：含多格式的大型目录（>1000 张）扫描、浏览与分类

* 打包测试：Windows 可执行运行与路径权限

## 里程碑

* A：CLI 扫描与 `metadata.json` 导出

* B：最小 UI（布局与预览/元数据）

* C：分类/归档视图与导出

* D：缩略图缓存、优化与打包

## 依赖

* `PySide6`, `Pillow`, `exifread` 或 `piexif`, `iptcinfo3`, （可选）`tifffile`, `pytest`, `pyinstaller`

如果该布局与功能符合预期，请确认，我将按里程碑开始实现并验证。
